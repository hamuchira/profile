<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã¯ã‚€ã´ã‚ˆ - ãƒãƒ ã‚¹ã‚¿ãƒ¼èµ¤ã¡ã‚ƒã‚“æˆé•·è¨˜éŒ²</title>
    
    <!-- PWAè¨­å®š -->
    <meta name="description" content="ãƒãƒ ã‚¹ã‚¿ãƒ¼èµ¤ã¡ã‚ƒã‚“ã®æˆé•·è¨˜éŒ²ã‚¢ãƒ—ãƒª">
    <meta name="theme-color" content="#f97316">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ã¯ã‚€ã´ã‚ˆ">
    
    <!-- ã‚¢ã‚¤ã‚³ãƒ³è¨­å®š -->
    <link rel="icon" type="image/png" sizes="192x192" href="hamupiyo-icon.png">
    <link rel="apple-touch-icon" sizes="192x192" href="hamupiyo-icon.png">
    <link rel="shortcut icon" href="hamupiyo-icon.png">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .icon {
            width: 20px;
            height: 20px;
            display: inline-block;
            vertical-align: middle;
        }
        body {
            background: linear-gradient(135deg, #fef7ed 0%, #fef3c7 100%);
            min-height: 100vh;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #fef7ed 0%, #fef3c7 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px -5px rgba(251, 146, 60, 0.1), 0 4px 6px -2px rgba(251, 146, 60, 0.05);
        }
        .hover-lift {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(251, 146, 60, 0.15), 0 10px 10px -5px rgba(251, 146, 60, 0.1);
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // ã‚¢ã‚¤ã‚³ãƒ³ã®SVGå®šç¾©
        const icons = {
            calendar: '<svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>',
            download: '<svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>',
            upload: '<svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>',
            plus: '<svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>',
            trash: '<svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>',
            edit: '<svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>'
        };

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹
        let state = {
            records: [],
            selectedMother: '',
            newMotherName: '',
            newBirthDate: '',
            isAddingMother: false,
            editingMother: null,
            showBackupModal: false
        };

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        function loadData() {
            try {
                // localStorageãŒåˆ©ç”¨å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
                if (typeof(Storage) === "undefined" || !localStorage) {
                    console.log('localStorage is not available');
                    return;
                }
                
                const savedRecords = localStorage.getItem('hamsterRecords');
                if (savedRecords) {
                    const parsedRecords = JSON.parse(savedRecords);
                    if (Array.isArray(parsedRecords)) {
                        state.records = parsedRecords;
                        if (parsedRecords.length > 0) {
                            state.selectedMother = parsedRecords[0].motherName;
                        }
                    }
                }
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ:', error);
                state.records = [];
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
        function saveData() {
            try {
                // localStorageãŒåˆ©ç”¨å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
                if (typeof(Storage) === "undefined" || !localStorage) {
                    console.log('localStorage is not available');
                    return;
                }
                
                if (state.records.length >= 0) {
                    localStorage.setItem('hamsterRecords', JSON.stringify(state.records));
                }
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ:', error);
            }
        }

        // æ—¥ä»˜ã‚’30æ—¥åˆ†ç”Ÿæˆ
        function generateDays(birthDate) {
            const days = [];
            const birth = new Date(birthDate);
            
            for (let i = 0; i <= 30; i++) {
                const date = new Date(birth);
                date.setDate(birth.getDate() + i);
                days.push({
                    day: i,
                    date: date.toISOString().split('T')[0],
                    displayDate: date.toLocaleDateString('ja-JP', {
                        month: 'numeric',
                        day: 'numeric',
                        weekday: 'short'
                    })
                });
            }
            return days;
        }

        // æ–°ã—ã„æ¯è¦ªã®è¨˜éŒ²ã‚’è¿½åŠ 
        function addMotherRecord() {
            if (!state.newMotherName.trim() || !state.newBirthDate) return;
            
            const newRecord = {
                id: Date.now(),
                motherName: state.newMotherName.trim(),
                birthDate: state.newBirthDate,
                days: generateDays(state.newBirthDate),
                notes: {}
            };
            
            state.records.push(newRecord);
            state.selectedMother = state.newMotherName.trim();
            state.newMotherName = '';
            state.newBirthDate = '';
            state.isAddingMother = false;
            saveData(); // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
            render();
        }

        // æ¯è¦ªã®è¨˜éŒ²ã‚’å‰Šé™¤
        function deleteMotherRecord(motherName) {
            if (confirm(`${motherName}ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                state.records = state.records.filter(record => record.motherName !== motherName);
                if (state.selectedMother === motherName) {
                    state.selectedMother = state.records.length > 0 ? state.records[0].motherName : '';
                }
                saveData(); // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
                render();
            }
        }

        // æ¯è¦ªåã‚’ç·¨é›†
        function editMotherName(oldName, newName) {
            if (!newName.trim()) return;
            
            state.records = state.records.map(record => 
                record.motherName === oldName 
                    ? { ...record, motherName: newName.trim() }
                    : record
            );
            
            if (state.selectedMother === oldName) {
                state.selectedMother = newName.trim();
            }
            state.editingMother = null;
            saveData(); // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
            render();
        }

        // ãƒ¡ãƒ¢ã‚’æ›´æ–°
        function updateNote(day, note) {
            state.records = state.records.map(record => 
                record.motherName === state.selectedMother
                    ? {
                        ...record,
                        notes: { ...record.notes, [day]: note }
                    }
                    : record
            );
            saveData(); // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        }

        // ç¾åœ¨é¸æŠä¸­ã®è¨˜éŒ²ã‚’å–å¾—
        function getCurrentRecord() {
            return state.records.find(record => record.motherName === state.selectedMother);
        }

        // CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportToCSV() {
            const currentRecord = getCurrentRecord();
            if (!currentRecord) return;
            
            const csvContent = [
                ['æ¯è¦ªå', 'èª•ç”Ÿæ—¥', 'ç”Ÿå¾Œæ—¥æ•°', 'æ—¥ä»˜', 'æ›œæ—¥', 'ãƒ¡ãƒ¢'],
                ...currentRecord.days.map(day => [
                    currentRecord.motherName,
                    currentRecord.birthDate,
                    `${day.day}æ—¥ç›®`,
                    day.date,
                    day.displayDate.split(' ')[1] || '',
                    currentRecord.notes[day.day] || ''
                ])
            ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');

            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${currentRecord.motherName}_æˆé•·è¨˜éŒ².csv`;
            link.click();
        }

        // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ
        function createBackup() {
            const dataStr = JSON.stringify(state.records, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            const now = new Date();
            const dateStr = now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0') + '-' + String(now.getDate()).padStart(2, '0');
            link.download = `ã¯ã‚€ã´ã‚ˆ_ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—_${dateStr}.json`;
            link.click();
        }

        // ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ
        function restoreData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const fileContent = e.target.result;
                    
                    // ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¨®é¡ã‚’åˆ¤å®š
                    if (file.name.endsWith('.json')) {
                        // JSONãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã®å ´åˆ
                        const importedData = JSON.parse(fileContent);
                        if (Array.isArray(importedData) && importedData.every(record => 
                            record.motherName && record.birthDate && record.days
                        )) {
                            if (confirm('æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨ã«ç½®ãæ›ãˆã¾ã™ï¼‰')) {
                                state.records = [...state.records, ...importedData];
                            } else {
                                state.records = importedData;
                                state.selectedMother = importedData.length > 0 ? importedData[0].motherName : '';
                            }
                            saveData(); // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
                            render();
                            alert('ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒãŒå®Œäº†ã—ã¾ã—ãŸï¼');
                        } else {
                            alert('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚\nã€Œãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€ã§ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                        }
                    } else {
                        alert('ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.jsonï¼‰ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚\nCSVãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã®å¾©å…ƒã¯ã§ãã¾ã›ã‚“ã€‚');
                    }
                } catch (error) {
                    alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\næ­£ã—ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // ä»Šæ—¥ã®æ—¥ä»˜ã‹ã‚‰ç”Ÿå¾Œä½•æ—¥ç›®ã‹ã‚’è¨ˆç®—
        function getCurrentDay() {
            const currentRecord = getCurrentRecord();
            if (!currentRecord) return null;
            
            try {
                const today = new Date();
                const birth = new Date(currentRecord.birthDate);
                const diffTime = today - birth;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays < 0 || diffDays > 30) return null;
                return diffDays;
            } catch (error) {
                console.error('æ—¥ä»˜è¨ˆç®—ã‚¨ãƒ©ãƒ¼:', error);
                return null;
            }
        }

        // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°
        function render() {
            const currentRecord = getCurrentRecord();
            const currentDay = getCurrentDay();

            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="gradient-bg max-w-6xl mx-auto p-6 min-h-screen">
                    <div class="bg-white rounded-xl card-shadow hover-lift p-6 mb-6">
                        <div class="text-center mb-6">
                            <div class="flex items-center justify-center gap-3 mb-1">
                                <img 
                                    src="hamupiyo-icon.png" 
                                    alt="" 
                                    class="w-12 h-12 object-contain"
                                    style="visibility: hidden;"
                                    onload="this.style.visibility = 'visible';"
                                    onerror="this.style.display = 'none';"
                                />
                                <h1 class="text-4xl font-bold text-orange-800">
                                    ã¯ã‚€ã´ã‚ˆ
                                </h1>
                            </div>
                            <p class="text-sm text-orange-600">ãƒãƒ ã‚¹ã‚¿ãƒ¼èµ¤ã¡ã‚ƒã‚“ã®æˆé•·è¨˜éŒ²</p>
                        </div>
                        
                        <div class="flex flex-col gap-4 mb-6">
                            <div class="flex flex-wrap gap-3 items-center justify-between">
                                <div class="flex items-center gap-3 flex-1 min-w-0">
                                    <select
                                        id="motherSelect"
                                        class="flex-1 min-w-0 px-3 py-2 border-2 border-orange-200 rounded-lg focus:border-orange-400 focus:outline-none text-sm"
                                    >
                                        <option value="">æ¯è¦ªã‚’é¸æŠ</option>
                                        ${state.records.map(record => 
                                            `<option value="${record.motherName}" ${record.motherName === state.selectedMother ? 'selected' : ''}>${record.motherName}</option>`
                                        ).join('')}
                                    </select>
                                    
                                    <button
                                        onclick="state.isAddingMother = true; render();"
                                        class="flex items-center gap-1 px-3 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-sm whitespace-nowrap"
                                    >
                                        ${icons.plus}
                                        è¿½åŠ 
                                    </button>
                                    
                                    ${state.selectedMother ? `
                                        <div class="flex gap-1">
                                            <button
                                                onclick="state.editingMother = '${state.selectedMother}'; render();"
                                                class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                                                title="åå‰ã‚’ç·¨é›†"
                                            >
                                                ${icons.edit}
                                            </button>
                                            <button
                                                onclick="deleteMotherRecord('${state.selectedMother}')"
                                                class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                                                title="è¨˜éŒ²ã‚’å‰Šé™¤"
                                            >
                                                ${icons.trash}
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            
                            ${currentRecord ? `
                                <div class="flex flex-wrap gap-2 justify-center">
                                    <button
                                        onclick="exportToCSV()"
                                        class="flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors text-sm"
                                    >
                                        ${icons.download}
                                        1åŒ¹CSVå‡ºåŠ›
                                    </button>
                                    
                                    <button
                                        onclick="createBackup()"
                                        class="flex items-center gap-2 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors text-sm"
                                    >
                                        ${icons.download}
                                        ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
                                    </button>
                                    
                                    <label class="flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors cursor-pointer text-sm">
                                        ${icons.upload}
                                        ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ
                                        <input
                                            type="file"
                                            accept=".json"
                                            onchange="restoreData(event)"
                                            class="hidden"
                                        />
                                    </label>
                                    
                                    <button
                                        onclick="state.showBackupModal = true; render();"
                                        class="text-gray-600 hover:text-gray-800 underline text-sm"
                                    >
                                        ãƒ‡ãƒ¼ã‚¿å¾©å…ƒæ–¹æ³•
                                    </button>
                                </div>
                            ` : ''}
                        </div>

                        ${state.isAddingMother ? `
                            <div class="bg-green-50 p-4 rounded-lg mb-6 border-2 border-green-200">
                                <h3 class="font-semibold text-green-800 mb-3 text-center">æ–°ã—ã„æ¯è¦ªã®è¨˜éŒ²ã‚’è¿½åŠ </h3>
                                <div class="flex flex-col gap-4 items-center">
                                    <div class="w-full max-w-md">
                                        <label class="block text-sm font-medium text-green-700 mb-1 text-center">æ¯è¦ªã®åå‰</label>
                                        <input
                                            type="text"
                                            id="newMotherName"
                                            value="${state.newMotherName}"
                                            oninput="state.newMotherName = this.value"
                                            class="w-full px-3 py-2 border border-green-300 rounded-lg focus:border-green-500 focus:outline-none text-sm text-center"
                                            placeholder="ä¾‹: ãƒãƒŠ"
                                        />
                                    </div>
                                    <div class="w-full max-w-md">
                                        <label class="block text-sm font-medium text-green-700 mb-1 text-center">èª•ç”Ÿæ—¥</label>
                                        <input
                                            type="date"
                                            id="newBirthDate"
                                            value="${state.newBirthDate}"
                                            oninput="state.newBirthDate = this.value"
                                            class="w-full px-3 py-2 border border-green-300 rounded-lg focus:border-green-500 focus:outline-none text-sm text-center"
                                        />
                                    </div>
                                    <div class="flex gap-2 mt-2">
                                        <button
                                            onclick="addMotherRecord()"
                                            class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm"
                                        >
                                            è¿½åŠ 
                                        </button>
                                        <button
                                            onclick="state.isAddingMother = false; render();"
                                            class="px-4 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 transition-colors text-sm"
                                        >
                                            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                        </button>
                                    </div>
                                </div>
                            </div>
                        ` : ''}

                        ${state.editingMother ? `
                            <div class="bg-blue-50 p-4 rounded-lg mb-6 border-2 border-blue-200">
                                <h3 class="font-semibold text-blue-800 mb-3">æ¯è¦ªã®åå‰ã‚’ç·¨é›†</h3>
                                <div class="flex flex-col sm:flex-row gap-3 items-end">
                                    <div class="flex-1 min-w-0">
                                        <label class="block text-sm font-medium text-blue-700 mb-1">æ–°ã—ã„åå‰</label>
                                        <input
                                            type="text"
                                            id="editNameInput"
                                            value="${state.editingMother}"
                                            class="w-full px-3 py-2 border border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm"
                                        />
                                    </div>
                                    <div class="flex gap-2">
                                        <button
                                            onclick="editMotherName('${state.editingMother}', document.getElementById('editNameInput').value)"
                                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm"
                                        >
                                            å¤‰æ›´
                                        </button>
                                        <button
                                            onclick="state.editingMother = null; render();"
                                            class="px-4 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 transition-colors text-sm"
                                        >
                                            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                                        </button>
                                    </div>
                                </div>
                            </div>
                        ` : ''}

                        ${currentRecord && currentDay !== null ? `
                            <div class="bg-yellow-100 border-l-4 border-yellow-500 p-4 mb-6">
                                <p class="text-yellow-800 font-semibold">
                                    ğŸ¯ ä»Šæ—¥ã¯ ${currentRecord.motherName} ã®èµ¤ã¡ã‚ƒã‚“ã®ç”Ÿå¾Œ ${currentDay} æ—¥ç›®ã§ã™ï¼
                                </p>
                            </div>
                        ` : ''}
                    </div>

                    ${currentRecord ? `
                        <div class="bg-white rounded-xl card-shadow hover-lift p-6">
                            <h2 class="text-xl font-semibold text-orange-800 mb-4 flex items-center gap-2">
                                ${icons.calendar}
                                ${currentRecord.motherName} ã®æˆé•·è¨˜éŒ²ï¼ˆèª•ç”Ÿæ—¥: ${new Date(currentRecord.birthDate).toLocaleDateString('ja-JP')}ï¼‰
                            </h2>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                                ${currentRecord.days.map((day) => `
                                    <div class="border-2 rounded-lg p-4 transition-all ${
                                        day.day === currentDay
                                            ? 'border-yellow-400 bg-yellow-50 shadow-md'
                                            : day.day === 0
                                            ? 'border-pink-300 bg-pink-50'
                                            : 'border-gray-200 bg-gray-50 hover:bg-gray-100'
                                    }">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="font-bold text-lg ${
                                                    day.day === currentDay ? 'text-yellow-700' :
                                                    day.day === 0 ? 'text-pink-700' : 'text-gray-700'
                                                }">
                                                    ${day.day === 0 ? 'èª•ç”Ÿæ—¥' : `${day.day}æ—¥ç›®`}
                                                </div>
                                                <div class="text-sm text-gray-600">
                                                    ${day.displayDate}
                                                </div>
                                            </div>
                                            ${day.day === currentDay ? '<span class="text-2xl">ğŸ¯</span>' : ''}
                                            ${day.day === 0 ? '<span class="text-2xl">ğŸ‚</span>' : ''}
                                        </div>
                                        
                                        <textarea
                                            placeholder="ãƒ¡ãƒ¢ã‚’å…¥åŠ›..."
                                            onchange="updateNote(${day.day}, this.value)"
                                            class="w-full h-20 p-2 text-sm border border-gray-300 rounded resize-none focus:border-orange-400 focus:outline-none"
                                        >${(currentRecord.notes && currentRecord.notes[day.day]) || ''}</textarea>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    ${state.records.length === 0 ? `
                        <div class="bg-white rounded-xl card-shadow hover-lift p-12 text-center">
                            <img 
                                src="hamupiyo-icon.png" 
                                alt="" 
                                class="w-16 h-16 mx-auto mb-4 object-contain"
                                style="visibility: hidden;"
                                onload="this.style.visibility = 'visible';"
                                onerror="this.style.display = 'none';"
                            />
                            <h3 class="text-xl font-semibold text-gray-600 mb-2">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</h3>
                            <p class="text-gray-500 mb-6">ã€Œè¿½åŠ ã€ãƒœã‚¿ãƒ³ã‹ã‚‰æœ€åˆã®è¨˜éŒ²ã‚’ä½œæˆã—ã¦ãã ã•ã„</p>
                            <button
                                onclick="state.isAddingMother = true; render();"
                                class="flex items-center gap-2 px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors mx-auto"
                            >
                                ${icons.plus}
                                æœ€åˆã®è¨˜éŒ²ã‚’ä½œæˆ
                            </button>
                        </div>
                    ` : ''}

                    <!-- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—èª¬æ˜ãƒ¢ãƒ¼ãƒ€ãƒ« -->
                    ${state.showBackupModal ? `
                        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div class="bg-white rounded-xl max-w-md w-full max-h-96 overflow-y-auto p-6">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">ğŸ“ ãƒ‡ãƒ¼ã‚¿å¾©å…ƒæ–¹æ³•</h3>
                                
                                <div class="space-y-4 text-sm text-gray-700">
                                    <div>
                                        <h4 class="font-semibold text-purple-700 mb-2">ğŸ”„ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©å…ƒã®æ‰‹é †</h4>
                                        <ol class="list-decimal list-inside space-y-1 ml-2">
                                            <li><strong>ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ</strong>ï¼šã€Œãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã€ãƒœã‚¿ãƒ³ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜</li>
                                            <li><strong>ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ</strong>ï¼šã€Œãƒ‡ãƒ¼ã‚¿å¾©å…ƒã€ã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</li>
                                            <li>ãƒ‡ãƒ¼ã‚¿ãŒå¾©å…ƒã•ã‚Œã¾ã™</li>
                                        </ol>
                                    </div>
                                    
                                    <div>
                                        <h4 class="font-semibold text-orange-700 mb-2">âš ï¸ ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã‚‹å ´åˆ</h4>
                                        <ul class="list-disc list-inside space-y-1 ml-2">
                                            <li>ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ãŸæ™‚</li>
                                            <li>ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ãŸæ™‚</li>
                                            <li>ç«¯æœ«ã‚’åˆæœŸåŒ–ã—ãŸæ™‚</li>
                                            <li>ç•°ãªã‚‹ç«¯æœ«ã‚„ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ä½¿ç”¨ã—ãŸæ™‚</li>
                                        </ul>
                                    </div>
                                    
                                    <div>
                                        <h4 class="font-semibold text-green-700 mb-2">ğŸ’¡ ãŠã™ã™ã‚</h4>
                                        <ul class="list-disc list-inside space-y-1 ml-2">
                                            <li>å®šæœŸçš„ï¼ˆé€±1å›ãªã©ï¼‰ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆ</li>
                                            <li>é‡è¦ãªè¨˜éŒ²ã‚’è¿½åŠ ã—ãŸå¾Œã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</li>
                                            <li>ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆGoogle Driveç­‰ï¼‰ã«ä¿å­˜</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="bg-blue-50 p-3 rounded-lg">
                                        <p class="text-blue-800"><strong>ğŸ“‹ CSVå‡ºåŠ›ã¨ã¯ï¼Ÿ</strong></p>
                                        <p class="text-blue-700">è¡¨è¨ˆç®—ã‚½ãƒ•ãƒˆï¼ˆExcelç­‰ï¼‰ã§ç¢ºèªãƒ»å°åˆ·ç”¨ã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿å¾©å…ƒã«ã¯ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚</p>
                                    </div>
                                </div>
                                
                                <button
                                    onclick="state.showBackupModal = false; render();"
                                    class="w-full mt-6 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors"
                                >
                                    é–‰ã˜ã‚‹
                                </button>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;

            // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å†è¨­å®š
            const motherSelect = document.getElementById('motherSelect');
            if (motherSelect) {
                motherSelect.addEventListener('change', (e) => {
                    state.selectedMother = e.target.value;
                    render();
                });
            }
        }

        // åˆæœŸåŒ–ã¨ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function init() {
            loadData(); // ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
            render();
            
            // Service Workerç™»éŒ²ï¼ˆPWAç”¨ï¼‰
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./sw.js').catch(error => {
                    console.log('Service Worker registration failed:', error);
                });
            }
        }

        // åˆæœŸãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        init();
    </script>
</body>
</html>
                                    